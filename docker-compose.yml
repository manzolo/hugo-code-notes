services:
  # Development server with live reload
  dev:
    image: hugomods/hugo:go-0.150.0
    container_name: hugo-dev
    command: hugo server --bind 0.0.0.0 --port 1313 --baseURL ${SITE_BASE_URL} --appendPort=false --buildDrafts
    ports:
      - "8080:1313"
    volumes:
      - ./:/src
    environment:
      - HUGO_ENV=development
    user: "${UID:-1000}:${GID:-1000}"

  # Build service (creates content in public/)
  build:
    image: hugomods/hugo:go-0.150.0
    container_name: hugo-build
    command: hugo --minify --baseURL="${SITE_BASE_URL}"
    volumes:
      - ./:/src
    environment:
      - HUGO_ENV=production
    user: "${UID:-1000}:${GID:-1000}"

  # Production server with auto-import from shared volume
  prod:
    build: .
    image: manzolo/code-notes
    container_name: hugo-prod
    ports:
      - "8080:80"
    volumes:
      - ./export:/export  # Shared volume for content transfer
    environment:
      - BACKUP_IMPORTED_ARCHIVE=false
    restart: unless-stopped

  # Alternative: nginx with shared volume (without custom Dockerfile)
  nginx:
    image: nginx:alpine
    container_name: hugo-nginx
    ports:
      - "8080:80"
    volumes:
      - ./export:/export
      - ./public:/usr/share/nginx/html:ro
      - ./conf/nginx.conf:/etc/nginx/conf.d/default.conf:ro
    restart: unless-stopped