services:
  # Development server
  hugo-dev:
    image: hugomods/hugo:go-${HUGO_VERSION:-0.150.0}
    container_name: ${DOCKER_COMPOSE_PROJECT:-hugo-blog}-dev
    command: >
      hugo server 
      --bind ${HOST:-0.0.0.0} 
      --port 1313
      --baseURL http://localhost:${PORT:-8080}/ 
      --appendPort=false 
      --buildDrafts=true
      --buildFuture=true
      --watch=true
      --poll 1000ms
      --disableFastRender=false
      --liveReloadPort=1313
    ports:
      - "${PORT:-8080}:1313"
    volumes:
      - ./:/src
      - /src/public
      - /src/resources
    environment:
      - HUGO_ENV=development
      - HUGO_THEME=${HUGO_THEME:-PaperMod}
    networks:
      - ${DOCKER_NETWORK:-hugo-network}
    restart: unless-stopped
    profiles:
      - dev

  # Build service
  hugo-build:
    image: hugomods/hugo:go-${HUGO_VERSION:-0.150.0}
    container_name: ${DOCKER_COMPOSE_PROJECT:-hugo-blog}-build
    command: hugo --minify --gc --baseURL="${SITE_BASE_URL:-http://localhost:8080/}"
    volumes:
      - ./:/src
    environment:
      - HUGO_ENV=production
      - HUGO_THEME=${HUGO_THEME:-PaperMod}
    networks:
      - ${DOCKER_NETWORK:-hugo-network}
    profiles:
      - build

  # Production Nginx
  nginx:
    image: nginx:alpine
    container_name: ${DOCKER_COMPOSE_PROJECT:-hugo-blog}-nginx
    ports:
      - "${PORT:-8080}:80"
    volumes:
      - ./public:/usr/share/nginx/html:ro
      - ./conf/nginx.conf:/etc/nginx/conf.d/default.conf:ro
    networks:
      - ${DOCKER_NETWORK:-hugo-network}
    profiles:
      - production
    restart: unless-stopped

  # Standalone container (build + nginx in one)
  hugo-prod:
    build:
      context: .
      dockerfile: Dockerfile
      target: production
    container_name: ${DOCKER_COMPOSE_PROJECT:-hugo-blog}-prod
    ports:
      - "${PORT:-8080}:80"
    networks:
      - ${DOCKER_NETWORK:-hugo-network}
    profiles:
      - standalone
    restart: unless-stopped

networks:
  hugo-network:
    name: ${DOCKER_NETWORK:-hugo-network}
    driver: bridge