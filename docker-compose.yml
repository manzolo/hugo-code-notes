services:
  # Development server with live reload
  dev:
    image: hugomods/hugo:go-0.150.0
    container_name: hugo-dev
    command: hugo server --bind 0.0.0.0 --port 1313 --baseURL http://localhost:8080/ --appendPort=false --buildDrafts
    ports:
      - "8080:1313"
    volumes:
      - ./:/src
    environment:
      - HUGO_ENV=development
    # Run as current user to avoid permission issues
    user: "${UID:-1000}:${GID:-1000}"

  # Production build
  build:
    image: hugomods/hugo:go-0.150.0
    container_name: hugo-build
    command: hugo --minify --baseURL="http://localhost:8080/"
    volumes:
      - ./:/src
    environment:
      - HUGO_ENV=production
    # Run as current user to avoid permission issues
    user: "${UID:-1000}:${GID:-1000}"

  # Production server with custom nginx config
  prod:
    build: .
    container_name: hugo-prod
    ports:
      - "8080:80"
    volumes:
      - ./public:/usr/share/nginx/html:ro
    restart: unless-stopped

  # Alternative nginx using image directly
  nginx:
    image: nginx:alpine
    container_name: hugo-nginx
    ports:
      - "8080:80"
    volumes:
      - ./public:/usr/share/nginx/html:ro
      - ./conf/nginx.conf:/etc/nginx/conf.d/default.conf:ro
    restart: unless-stopped